<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Regist : Hippocampus</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="../script/jquery.min.js"></script>
    <script type="text/javascript" src="../script/bootstrap.min.js"></script>
    <script src="../script/header_ctrl.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="../style/regist.css">
    <link rel="stylesheet" type="text/css" href="../style/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../style/headerfooter.css">

</head>
<body onresize="set_wrong_window()">
    <div class="row" id="header">
        <div class="col-md-2 col-sm-2">
            <img src="../images/logo.png" width="40px" alt="hpcp"></img>
            <span style="font-size:18px;font-family:Microsoft Yahei;">海马体</span>
        </div>
        <!-- <div class="col-md-1" style="">

        </div> -->
        <div class="col-md-2 col-sm-2" id="weather">city:weather</div>

        <div class="col-md-3 col-sm-3 pull-right" id="user-info">
            <div class="row">
                <div class="col-md-4 col-sm-4" id="user-icon">
                    <img class="user-img" src="../images/icon.jpg" />
                </div>
                <div class="col-md-6 col-sm-6" id="user-name" onmouseleave="remove_li()">
                    <ul>
                        <p id="up" onmouseover="load_li()">UserName<span class="caret"></span></p>
                        <li class="li-first" id="user-center">
                            user-center
                            <div class="hr"></div>
                        </li>
                        <li id="account-set">
                            account-set
                            <div class="hr">
                            </div>
                        </li>
                        <li id="logout"></span>logout</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div id="regist-input">
        <form class="form-control form-horizontal" id="regist-form">
            <div class="form-group">
                <label for="inputEmail3" class="col-md-3 control-label">注册邮箱</label>
                <div class="col-md-5">
                    <input type="email" class="form-control" id="input-Email1" placeholder="输入正确的邮箱格式">
                </div>
                <div class="col-md-4 reminder" id="input-email-remind">
                </div>
            </div>
            <div class="form-group">
                <label for="inputnickname" class="col-md-3 control-label">昵称</label>
                <div class="col-md-5">
                    <input type="text" class="form-control" id="nickname" placeholder="输入您的想要的昵称，不允许特殊字符">
                </div>
                <div class="col-md-4 reminder" id="nick-remind">
                </div>
            </div>
            <div class="form-group">
                <label for="inputEmail3" class="col-md-3 control-label">密码</label>
                <div class="col-md-5">
                    <input type="password" class="form-control" id="password" placeholder="密码长度为6到16个字符">
                </div>
                <div class="col-md-4 reminder" id="key-remind">
                </div>
            </div>
            <div class="form-group">
                <label for="inputEmail3" class="col-md-3 control-label">密码确认</label>
                <div class="col-md-5">
                    <input type="password" class="form-control" id="password2" placeholder="再次输入密码">
                </div>
                <div class="col-md-4 reminder" id="key-again-remind">
                </div>
            </div>
            <input id="agree" type="checkbox" name="agree" />
            <label>我已同意</label>
            <a href="" target="_blank" style="text-decoration:none">《Hippocampus用户注册协议》</a>
            <div class="form-group">
                <div class="col-md-4 col-md-offset-4">
                    <input type="button" class="form-control" onclick="registAction()" value=" 注册并登录" />
                </div>
            </div>
        </form>
    </div>
    <div class="row" id="wrong-window">
        <div class="row">
            <div class="col-md-9">
            </div>
            <div class="col-md-3" style="text-align:center">
                <h3 style="color:#f60;cursor:pointer;" id="close">×</h3>
            </div>
        </div>
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <p id="wrong-info"></p>
            </div>
        </div>
    </div>

    <script type="text/javascript" charset="UTF-8">




        set_wrong_window();
        $("#close").click(function () {
            $("#wrong-window").fadeOut(300);
        });

        $("#input-Email1").blur(function () {
            var email = document.getElementById("input-Email1").value;
            isEmail(email);
        });

        $("#password").blur(function () {
            var password = document.getElementById("password").value;
            $("#key-remind").html(password.length.toString());
            if (password.length < 6) {
                $("#key-remind").html('<img src="../images/wrong.png" class="wrong"/><span style="color:red">密码长度为6到16个字符!</span>');
            }
            else if (password.length > 16) {
                $("#key-remind").html('<img src="../images/wrong.png" class="wrong"/><span style="color:red">密码长度为6到16个字符!</span>');
            }
            else {
                $("#key-remind").html('<img src="../images/ok.png" class="ok"/><span class="glyphicon-class" style="color:green;">请再次输入密码</span>');
            }

        });

        $("#password2").blur(function () {
            var password = document.getElementById("password").value;
            var password2 = document.getElementById("password2").value;
            if (password2 == password) {
                if (password2.length >= 6 && password2.length <= 16) {
                    $("#key-again-remind").html('<img src="../images/ok.png" class="ok"/>');
                    $("#key-remind").html('<img src="../images/ok.png" class="ok"/>');
                }
                else {
                    $("#key-again-remind").html('<img src="../images/wrong.png" class="wrong"/><span style="color:red;">请输入合法密码</span>');
                }

            }
            else {
                $("#key-again-remind").html('<img src="../images/wrong.png" class="wrong"/><span style="color:red;">密码前后不相等，请重新确认</span>');
            }
        });

        $("#nickname").blur(function () {
            var nickname = document.getElementById("nickname").value;
            isNickLegal(nickname);

        });

        function registAction() {
            var agree = document.getElementById("agree").checked;

            var email = document.getElementById("input-Email1").value;
            var password = document.getElementById("password").value;
            var password2 = document.getElementById("password2").value;
            var nickname = document.getElementById("nickname").value;



            if (!isEmail(email)) {
                show_wrong_window("邮件地址不合法！");
                return false;
            }

            if (!agree) {
                show_wrong_window("请先阅读用户协议！");
                return false;
            }

            // if (!isLengthLegal(password)) {
            //     return false;
            // };



            if (password != password2) {
                show_wrong_window("密码前后不相等，请重新确认！");
                return false;
            }

            password = hex_md5(password);
            password2 = hex_md5(password2);
            var ajax = Ajax();
            var form = new FormData();
            form.append("email", email);
            form.append("password", password);
            form.append("nickname", nickname);

            ajax.onreadystatechange = function () {
                if (ajax.readyState == 4 && ajax.status == 200) {
                    var resText = ajax.responseText;
                    $("#alerttext").html(resText);
                    localStorage.setItem("penta_login", email);
                    alert("注册成功\n\n点击确定进入登陆页面");
                    location.href = "../login/login.html";
                }
            }

            ajax.open("POST", "../php/action_regist.php", true);
            ajax.send(form);

        }

        function isNickLegal(nickname) {
            if (nickname.length > 0) {
                $("#nick-remind").html('<img src="../images/ok.png" class="ok"/><span style="color:green;">昵称可用</span>');
            }
            else {
                $("#nick-remind").html('<img src="../images/wrong.png" class="wrong"/><span style="color:red">请确保昵称不为空</span>');
            }
        }


        function isEmail(email) {
            //对电子邮件的验证
            var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
            if (!myreg.test(email)) {
                $("#input-email-remind").html('<img src="../images/wrong.png" class="wrong"/><span style="color:red">请输入有效的Email！</span>');

                return false;
            }
            $("#input-email-remind").html('<img src="../images/ok.png" class="ok"/><span style="color:green;">邮箱可用</span>');
            return true;
        }

        function message(str) {
            document.getElementById("alertText").innerHTML = str;
        }


    </script>
    <div id="footer">
        ©2014 Hippocampus : Fork Me In GITHUB!
    </div>
</body>
</html>